{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "PRO0 Configuration",
  "description": "Configuration for PRO0 team-based dynamic agent system. proManager is the sole primary agent (team leader) that plans and delegates to dynamically spawned agents organized by category.",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "proManager": {
      "type": "object",
      "description": "Manager agent configuration — the sole primary agent that plans first, then delegates execution to team agents",
      "properties": {
        "model": {
          "type": "string",
          "description": "Model to use for Manager agent (e.g., 'github-copilot/claude-sonnet-4.5')"
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Temperature for model sampling (0-2)"
        },
        "top_p": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Top-p (nucleus sampling) parameter"
        },
        "max_retry_on_test_failure": {
          "type": "integer",
          "minimum": 1,
          "default": 3,
          "description": "Maximum number of retries when tests fail"
        },
        "coding_allowed": {
          "type": "boolean",
          "default": false,
          "description": "Whether Manager is allowed to write code directly (should be false for pure delegation)"
        },
        "mandatory_todos": {
          "type": "boolean",
          "default": true,
          "description": "Require TodoWrite tool usage for tracking progress"
        },
        "ralph_loop": {
          "type": "object",
          "description": "Ralph loop configuration for iterative task execution with self-review",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable Ralph loop (iterative execution with self-review)"
            },
            "max_iterations": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "default": 5,
              "description": "Maximum number of iterations before triggering self-review"
            },
            "auto_review": {
              "type": "boolean",
              "default": true,
              "description": "Automatically trigger self-review when all tasks complete"
            },
            "continuation": {
              "type": "object",
              "description": "Continuation behavior when max iterations reached",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Allow continuation when max iterations reached with incomplete tasks"
                },
                "ask_user_at_max": {
                  "type": "boolean",
                  "default": true,
                  "description": "Prompt user for decision at max iterations"
                },
                "default_extension": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 10,
                  "default": 5,
                  "description": "Default number of additional iterations to offer"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "planning": {
          "type": "object",
          "description": "Planning phase configuration (PRD workflow merged from old proPlanner)",
          "properties": {
            "require_approval": {
              "type": "boolean",
              "default": true,
              "description": "Require user approval between PRD creation and execution"
            },
            "auto_prd": {
              "type": "boolean",
              "default": true,
              "description": "Auto-create PRD for complex tasks (3+ subtasks)"
            },
            "prd_directory": {
              "type": "string",
              "default": ".pro0/prds",
              "description": "Directory for PRDs (relative to project root)"
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["model"],
      "additionalProperties": false
    },
    "team": {
      "type": "object",
      "description": "Team configuration — controls dynamic agent spawning, concurrency, and resource-aware throttling",
      "properties": {
        "maxParallel": {
          "type": "integer",
          "minimum": 1,
          "default": 3,
          "description": "Maximum agents running simultaneously"
        },
        "maxTotal": {
          "type": "integer",
          "minimum": 1,
          "default": 10,
          "description": "Maximum agents that can be spawned per task"
        },
        "resourceAware": {
          "type": "boolean",
          "default": true,
          "description": "Adjust concurrency limits based on system CPU/memory usage"
        },
        "resourceLimits": {
          "type": "object",
          "description": "Resource thresholds for throttling agent spawning",
          "properties": {
            "maxMemoryPercent": {
              "type": "number",
              "minimum": 10,
              "maximum": 100,
              "default": 80,
              "description": "Throttle if memory usage exceeds this percent"
            },
            "maxCpuPercent": {
              "type": "number",
              "minimum": 10,
              "maximum": 100,
              "default": 90,
              "description": "Throttle if CPU usage exceeds this percent"
            }
          },
          "additionalProperties": false
        },
        "categories": {
          "type": "object",
          "description": "Agent categories with default models. Built-in categories: coding, review, research, ops, design. Custom categories can be added.",
          "additionalProperties": {
            "$ref": "#/$defs/agentCategory"
          }
        }
      },
      "required": ["maxParallel", "maxTotal", "resourceAware", "categories"],
      "additionalProperties": false
    },
    "templates": {
      "type": "object",
      "description": "Template agents (evolved from old specialists). The manager can use these as starting points when spawning agents. Keys are template names (e.g., 'designer', 'backend-coder').",
      "additionalProperties": {
        "$ref": "#/$defs/templateConfig"
      }
    },
    "skills": {
      "type": "object",
      "description": "Skills configuration — controls bundled skill behavior (QMD, DeepThink)",
      "properties": {
        "auto_load": {
          "type": "boolean",
          "default": true,
          "description": "Automatically scan and load skills from directories"
        },
        "disabled": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of skill names to exclude from auto-loading"
        },
        "qmd": {
          "type": "object",
          "description": "QMD (Query Markdown Documentation) skill configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable QMD skill"
            },
            "searchMode": {
              "type": "string",
              "enum": ["bm25", "semantic", "hybrid"],
              "default": "bm25",
              "description": "Search algorithm for documentation queries"
            },
            "minScore": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.3,
              "description": "Minimum relevance score threshold for results"
            },
            "timeout": {
              "type": "integer",
              "minimum": 1000,
              "default": 30000,
              "description": "Timeout for QMD queries in milliseconds"
            },
            "mcp": {
              "type": "object",
              "description": "MCP server configuration for QMD",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false,
                  "description": "Enable MCP server for QMD"
                },
                "command": {
                  "type": "string",
                  "description": "Command to start the MCP server"
                },
                "args": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Arguments for the MCP server command"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "deepthink": {
          "type": "object",
          "description": "DeepThink skill configuration for complex reasoning tasks",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable DeepThink skill"
            },
            "defaultMode": {
              "type": "string",
              "enum": ["full", "quick", "auto"],
              "default": "auto",
              "description": "Default thinking mode"
            },
            "maxIterations": {
              "type": "integer",
              "minimum": 1,
              "default": 5,
              "description": "Maximum reasoning iterations"
            },
            "subAgentModel": {
              "type": "string",
              "description": "Model for the DeepThink sub-agent"
            },
            "timeout": {
              "type": "integer",
              "minimum": 1000,
              "description": "Timeout for DeepThink in milliseconds"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "verification": {
      "type": "object",
      "description": "Verification and testing configuration — run after task completion",
      "properties": {
        "run_tests_after_completion": {
          "type": "boolean",
          "default": true,
          "description": "Run tests after execution completes"
        },
        "test_command": {
          "type": "string",
          "default": "npm test",
          "description": "Command to run tests"
        },
        "allow_partial_success": {
          "type": "boolean",
          "default": false,
          "description": "Allow some test failures (report but don't block)"
        },
        "regression_check": {
          "type": "boolean",
          "default": true,
          "description": "Ensure unchanged functions still pass tests"
        }
      },
      "additionalProperties": false
    },
    "proPlanner": {
      "type": "object",
      "description": "DEPRECATED — Legacy v0.2 planner config. Auto-migrated to proManager.planning on load.",
      "deprecated": true
    },
    "specialists": {
      "type": "object",
      "description": "DEPRECATED — Legacy v0.2 specialists config. Auto-migrated to templates on load.",
      "deprecated": true
    },
    "background_tasks": {
      "type": "object",
      "description": "DEPRECATED — Legacy v0.2 background tasks config. Auto-migrated to team limits on load.",
      "deprecated": true
    }
  },
  "required": ["proManager"],
  "additionalProperties": false,
  "$defs": {
    "agentCategory": {
      "type": "object",
      "description": "An agent category defining a role with default model and behavior",
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable category name"
        },
        "description": {
          "type": "string",
          "description": "What this category is for"
        },
        "defaultModel": {
          "type": "string",
          "description": "Default model for agents in this category"
        },
        "defaultTemperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Default temperature for agents in this category"
        },
        "defaultTools": {
          "type": "object",
          "description": "Default tool permissions (e.g., { \"write\": true, \"edit\": true, \"bash\": true })",
          "additionalProperties": {
            "type": "boolean"
          }
        },
        "basePromptTemplate": {
          "type": "string",
          "description": "Path to base prompt template (relative to agents/ or .pro0/agents/)"
        }
      },
      "required": ["name", "description", "defaultModel"],
      "additionalProperties": false
    },
    "templateConfig": {
      "type": "object",
      "description": "A template agent configuration (evolved from old specialists)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable this template agent"
        },
        "model": {
          "type": "string",
          "description": "Model override for this template (falls back to category default)"
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Temperature override"
        },
        "top_p": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Top-p override"
        },
        "scope": {
          "type": "string",
          "description": "Scope modifier (e.g., 'frontend-components' for designer)"
        },
        "category": {
          "type": "string",
          "description": "Category this template belongs to (e.g., 'coding', 'review', 'research', 'ops', 'design')"
        }
      },
      "required": ["enabled"],
      "additionalProperties": false
    }
  }
}
